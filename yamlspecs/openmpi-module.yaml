# This "copies" the system openmpi module file  into a standard
# standard naming convention 
!include /opt/rcic/include/rcic-module.yaml
---
- package: openmpi module 
  name: openmpi 
  pkgname: "{{ name }}_{{version}}-module"
  category: TOOLS
  prefix: /usr
  compiler: gcc 
  compiler_version: "4.8.5" 
  description: |
    Module file for system defined Openmpi version {{ version }} compiled with GCC version {{ compiler_version }}.
    Changes with major OS version changes
  root: "{{ pkg_defaults.module.path }}/{{ name }}/{{compiler}}/{{compiler_version}}"
  no_src_dir: True
  extension: 
  requires:
    - rcic-module-support
    - openmpi
    - openmpi-devel
  version:  1.10.7

  ## Define the key components of the environment module\n
  module:
    name: "{{ version }}"
    path: "{{root}}"


    prereq: 
       - "{{ compiler }}/{{ compiler_version }}"


    setenv:
      - MPI_BIN /usr/lib64/openmpi/bin
      - MPI_SYSCONFIG /etc/openmpi-x86_64
      - MPI_FORTRAN_MOD_DIR /usr/lib64/gfortran/modules/openmpi-x86_64
      - MPI_INCLUDE /usr/include/openmpi-x86_64
      - MPI_LIB /usr/lib64/openmpi/lib
      - MPI_MAN /usr/share/man/openmpi-x86_64
      - MPI_PYTHON_SITEARCH /usr/lib64/python2.7/site-packages/openmpi
      - MPI_COMPILER openmpi-x86_64
      - MPI_SUFFIX _openmpi
      - MPI_HOME /usr/lib64/openmpi

    prepend_path:
      - PATH /usr/lib64/openmpi/bin
      - LD_LIBRARY_PATH /usr/lib64/openmpi/lib
      - PYTHONPATH /usr/lib64/python2.7/site-packages/openmpi
      - MANPATH /usr/share/man/openmpi-x86_64
